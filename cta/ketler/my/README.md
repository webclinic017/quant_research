# 回测内容
这个是参考王纯迅的[纯享投资](https://www.bilibili.com/video/BV1rz4y1k77Y)，
来做的一个回测项目。

重点参考了[【硬核】年化20%的算法交易，财务自由就靠他了](https://www.bilibili.com/video/BV1d5411P7Lt)。

# 算法
- 
- 根据历史，计算上下的区间，也就是覆盖80%的上和下就可以，形成一个网格区间，这个区间是变化，随着时间向前会不断地变化。
- 某天都可以计算出偏离均线的百分比，当发现这个百分比下降一格，就可以出发网格交易了。
- 回顾了510500中证500ETF的偏离年线的百分比，上80%在18%，下80%在-17%，所以，综合认为在上下18%就可以，
- 我们可以设计一个算法，每2%是一个格子，每下跌1格就加仓多1份，每上升1格就多减仓1份
- 只有跌破年线才买入，只有上穿年线才卖出，越涨卖的越多

## 参数

算法涉及到的参数包括：
- 网格的大小：目前是2%，是观察中证500ETF的偏离年线的80%都在[+18%,-18%]这个区间
- 每个网格的投资份数：目前是10000份，这个是不好调节的参数
- 使用的均线：目前用的是年线，242天
- 总资金数：这个是你的弹药，不充分就会导致投到中间就没有钱再投了

## 其他思考

资金利用率：就是你总共的总现金，比如50万，
但是你实际投资进去20万，那么你利用率就是 20/50 = 40%，
但是，你中间可能卖出，你可能亏了钱、或者赚了钱，那该如何算利用率？
算法是：

1、先算投入部分的总收益 = 最终市值+总卖出 - 总买入

2、然后刨除用获利的重复投资，得到实际投入

实际投入 = 总买入 - 投入部分总收益 = 总买入 - （最终市值+总卖出 - 总投入）
= 2*总投入 -  最终市值 - 总卖出

所以，资金利用率就是 = 实际投入/开始的总现金

## 优化

- 考虑到只投到一个etf基金，会让资金利用率偏低，所以想到准备一揽子基金来做这个事。
- 每只基金来抢这个资金，谁有投资机会就让谁来投
- 每只基金都默认采用20、60、120、240，来作为均线
- 网格尽量设置成10，所以要对每个基金做偏离均线的统计，从而动态确定网格高度
- 网格按照80%的原则来统计分位数，如80%在18%，那么网格高度就是：18%/10 = 2%
- 每次购买某个基金不能按照份数来，会导致资金分配不均匀，按照金额来投
- 每次投入的金额是一个超参，需要来跑出一个最优的
- 每个网格买入、卖出都是固定的份数，我开始想用金额，但是买入可以，但是卖出不行。
  所以，就还是改回了份数，但是，我是想每个基金都分配同样的资金量，那么，就要开始计算一下各自的网格份数

## 实现

- 

# ETF基金

截至2022年10月10日，全市场ETF总共有**745**只，其中被动指数型基金有634只，QDII基金有45只，货币市场型基金27只。

- 宽基指数ETF数量152只，规模4562亿元，占股票类ETF总规模39%。
- 行业指数ETF数量334只，规模4374亿元，占股票类ETF总规模38%。
- 跨境型ETF数量72只，规模为1679亿元买，占比为15%。
- 主题指数ETF数量67只，规模为611亿元，占比为5%。
- Smart Beta ETF 35只，规模分别为344亿元，占比为3%。
- 增强指数ETF数量5只，规模为40亿元，占比为0.3%。

## 挑选ETF
因为同一个指数ETF，很多家基金公司都在做，所以挑选一些典型的ETF来测试,
挑选选择：1、时间足够长；2、价格不是很贵（未拆分）：
- 沪深300ETF易方达 510310
- 国寿安保中证500ETF 510560
- 券商ETF 512000
- 易方达沪深300医药ETF 512010 / 2013
- 价值100ETF 512040 / 2018
- 易方达沪深300非银ETF 512070 / 2014
- 南方中证500信息技术ETF 512330  / 2015
- 国联安中证半导体ETF 512480 / 2019
- 易方达中证军工ETF 512560 / 2017
- 嘉实中证主要消费ETF 512600  / 2014

510310,510560,512000,512010,512040,512070,512330,512480,512560,512600

暂时先这些，随意挑的，回头写个程序挑

**手续费：**

参考华宝证券：ETF手续费万1，单笔最低0.2元