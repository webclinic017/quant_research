# 文件说明

主要是备份iquant/qmt中的脚本
这些脚本都是生产版本。

# 设计思路

QMT很难用，各种问题，我在[QMT趟坑记](http://book.piginzoo.com/knowledge/develope/qmt.html)中，已经详细地描述了。
这里仅记录实盘过程当中的一些设计思路和实现细节。

大体思路是：
- 策略写到[dingtou](https://github.com/piginzoo/quant_research/tree/main/dingtou)这个项目里，既是回测用，也是实盘的策略。
- 把dingtou pip install到本地，然后再QMT中import，然后QMT设置一个策略，每个1分钟来调用dingtou策略
- 如果dingtou策略给出了买信号，就用QMT下单，如果是卖信号，就用QMT卖掉股票，金额的大小都是策略告诉他的
- 为了监控服务器和QMT软件，我写了个心跳程序，定期发送心跳到我自己的服务器，顺道也发送一些交易日志。

关于实盘机器：

我用的是一台零刻的mini主机，2000元（16G内存+500GSSD+6和12线程AMD）。主要是我发现云主机都太贵了，后来听朋友说有800元的，2核4G的，
我怎么就找不到呢？唉。所以才买了这个自己觉得性价比最高的，也最安全（防止被云端hack了）的机器，放置到家里。
也因为如此，我需要做一个监控。

## 下单
下单用的是，passorder，它是qmt中最灵活的下单，我采用了按照金额下单的方式， 主要原因是我要买7支ETF基金，按照平均分配资金的原则来买的，
如果是按照固定股数，就会导致基金件资金分配不均。

但是采用资金下单，我当时就好奇，它会自动帮我买卖整手数么？答案是肯定的，比如我下单买或卖110元，股价是1元，那么只会成交100元，也就是买卖100手。
它会自动帮我取整到整手数。挺好，省的我自己算股数了。

另外，我用的卖2价来买，用买2价来卖，方便快速成交。

还有个问题，就是你必须要在bar的最后一个tick下单，才会生成买卖订单，之前的tick里下的都没用，这个特性很讨厌。
它又不提供类似于context.is_last_tick_of_bar之类的函数，我就没办法了，除非我一直在这个bar的所有tick都下单。
最后，我的办法是，使用passorder的quickTrade=1，来即刻触发下单，这个标志不等到下一个bar的第一个tick再创建订单了，而是立刻创建。
然后，我又做一个标志，如果下单了，就写个标志文件，就不再下单了。
这样做，虽然可以，但是，如果这单没成交，我就没有再check了，可能会有些问题，将来出问题再想办法吧。

>[参](https://zhuanlan.zhihu.com/p/587304791)：
> 当盘中运行到最后一根 K 线的时候，每个 tick 数据来时都会判定一下这个条件是否成立，当不 是这根 K 线的最后一个 tick，之前的所有的 tick 成立的产生的信号就是虚的信号。只有当这个 K 线确定 时，产生的信号才是有效信号，才会触发下单。

## 心跳

我写了一个服务器，用来监控QMT软件，和，服务器本身是否是好的。代码可以参考我的[quant_trader](https://github.com/piginzoo/quant_trader)项目，
我会让qmt把持仓、成交、市值等信息，推给服务器，然后服务器会保存到服务器上，可以方便后续我通过web端来查看，同时，每天都会生成一个文件，方便日后复盘。

我在服务器上开了个定时器，如果是周一到周五且是交易时间，如果发现超过超时时间（30分钟），就会触发报警，报警会推送微信、邮件等。
这样如果我的服务器有问题，我可以第一时间知道。

而且，我通过这个心跳，也可以即时地查看我的机器的信息和交易的信息。

